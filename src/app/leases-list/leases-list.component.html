<div class="search-container">
  <form class="example-form">
    <mat-form-field class="example-full-width" color="accent">
      <input matInput placeholder="Search by username" [formControl]="searchInput" class="search-input">
    </mat-form-field>
  </form>
</div>
<div class='leases-container' *ngIf='!searchFailed && !leasesFetchFailed'>

  <table mat-table [dataSource]="term=='' ? allLeases : searchLeases" class="mat-elevation-z8">

    <ng-container matColumnDef="id">
      <th mat-header-cell *matHeaderCellDef> ID </th>
      <td mat-cell *matCellDef="let lease"> {{lease.id}} </td>
    </ng-container>

    <ng-container matColumnDef="user">
      <th mat-header-cell *matHeaderCellDef> Username </th>
      <td mat-cell *matCellDef="let lease"> {{lease.user? lease.user.username : '' }} </td>
    </ng-container>

    <ng-container matColumnDef="timeOfLease">
      <th mat-header-cell *matHeaderCellDef> Time of lease </th>
      <td mat-cell *matCellDef="let lease"> {{lease.timeOfLease  | date:'dd-MMM yyyy   HH:mm:ss'}} </td>
    </ng-container>

    <ng-container matColumnDef="due_time">
      <th mat-header-cell *matHeaderCellDef> Due time </th>
      <td mat-cell *matCellDef="let lease"> {{lease.dueTime  | date:'dd-MMM yyyy   HH:mm:ss'}} </td>
    </ng-container>

    <ng-container matColumnDef="inventoryBook">
      <th mat-header-cell *matHeaderCellDef> Book name </th>
      <td mat-cell *matCellDef="let lease"> {{lease.inventoryBook.catalogBook.title}} </td>
    </ng-container>

    <ng-container matColumnDef="returned">
      <th mat-header-cell *matHeaderCellDef> Returned </th>
      <td mat-cell *matCellDef="let lease">{{lease.returned ? 'Yes' : 'No'}}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"
      [ngClass]="{'red': isLeaseExpired(row.due_time),'green':row.returned}" (click)='openDialog(row)'></tr>
  </table>

  <div class='information'>
    <span class='bg bg-red'></span> <span class='description'>Not returned & expired</span>
    <span class='bg bg-green'></span> <span class='description'>Returned in time</span>
  </div>
</div>

<div class='search-error' *ngIf="searchFailed || leasesFetchFailed">
  <h4>Some error happened while fetching, please refresh the page and try again..</h4>
</div>
